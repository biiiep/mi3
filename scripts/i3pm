#!/bin/sh

lock()
{
	#i3lock -t -i ${HOME}/.i3/wallpaper.png -c 000000
	busctl call \
		org.freedesktop.DisplayManager \
		/org/freedesktop/DisplayManager/Seat0 \
		org.freedesktop.DisplayManager.Seat \
		Lock
}

dbus_send()
{
	busctl call \
		org.freedesktop.login1 \
		/org/freedesktop/login1 \
		org.freedesktop.login1.Manager \
		"$1" b True
}

case "$1" in
	lock)
		lock || exit $?
		;;
	suspend)
		lock || exit $?

		dbus_send Suspend
		;;
	hibernate)
		lock || exit $?

		dbus_send Hibernate
		;;
	reboot)
		lock || exit $?

		dbus_send Reboot
		;;
	poweroff)
		lock || exit $?

		dbus_send PowerOff
		;;
	daemon)
		# TODO start script to do power management
		# needs to implement handler for
		# - low and critical battery state
		# - low and critical battery libnotify message
		;;
	*)
		echo "$0 <suspend|hibernate|lock|reboot|poweroff>"
		exit 1
esac
